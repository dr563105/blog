{
  
    
        "post0": {
            "title": "Setting up AWS EC2 instance for ML",
            "content": "Amazon Web Services(AWS) offer great many services to suit user needs. For ML/DL all one needs is a computer with access to a Graphical Processing Unit(GPU). Since AWS offers a virtual PC with GPU at a reasonable price, we will use their service. This blog post will use an AWS EC2 instance to make it ready for running ML tasks. . Pre-requisites: This guide expects you to be familiar with linux(Ubuntu) environment and activated your AWS account. . Fast.ai . We will use Fastai library to make our ML models. Fastai is a open source software library for deep learning. Developing ML models using fastai makes it much easier than just Pytorch. . Note: This post is similar to the fastai’s guide for AWS setup but with added commentary and updated final instructions. . AWS EC2 . AWS EC2 is a service that provides a server PC for our use. It comes with a template called amazon machine image(AMI) that makes it so easy to launch a virtual cloud server in less than two minutes. . For our ML purpose, we will use g4dn.xlarge EC2 on-demand instance. This particular instance has a 16GB Nvidia T4 GPU. For more info on instances, check out this page at AWS. . Note: Servers in regions(also known as availability zones(AZ)) such as North Virginia(N. Virginia), Ohio offer the chepeast prices for g4dn instances starting at $0.526 per hour. Check out the pricing here. . Requesting service limit increase . To avoid misuse of GPU, amazon restricts its usage. However, we can request for service limit increase with a support ticket. It is important to remember, service limit needs to be increased for each region. The number of vCPUs an instance has, is a good measure of its capacity. In this case, request 16vCPUs(upto g4dn.4xlarge) in the support ticket. Follow this step to get access to a GPU. . Tip: Usually a description of ‘to use for ML/DL course and training models’ would be an acceptable reason for approval. . Import key pair to AWS EC2 region . Use this amazon guide to import generate and import rsa key pair to an AWS EC2 region or AZ. It is important to store the private key in a secure directory. . Launch instance . Use this fastai step to launch an g4dn.xlarge instance. . Connect to instance . Using the public IP of the instance and rsa private key we can login into our instance. . Login using . ssh -i &lt;path-to-pem-file&gt; ubuntu@&lt;ip-address&gt; . The username is ubuntu for ubuntu EC2 instance, ec2-user for amazon AMI, and so on. We will be using ubuntu ec2 g4dn instance. . Example: . ssh -i ~/.ssh/myprivatekey.pem ubuntu@&lt;ip&gt; . You may be prompted about trusting this address, to which you should reply ‘yes’. . Solution to possible shell environment problems: In some cases if the host terminal is using a different XTERM environment such as xterm-kitty(echo $TERM), that environment is reflected in the remote EC2 instance. If that is the case, it best to use this command: . TERM=&#39;xterm-256color&#39; ssh -i &lt;path-to-pem-file&gt; ubuntu@&lt;ip-address&gt; . Also a possibility would be to add the TERM env to bashrc file. . echo &#39;export TERM=xterm-256color&#39; &gt;&gt; ~/.bashrc source ~/.bashrc . Why the need to do to set the TERM env? Because, remote host will have the basic env set and the keystrokes such as previously run command(up arrow) would return a scrambled output on the screen. . Setup Ubuntu server . First, to do basic ubuntu configurations, such as updating packages, and turning on auto-updates, execute: . sudo apt update &amp;&amp; sudo apt -y install git git clone https://github.com/dr563105/fastsetup.git cd fastsetup sudo ./ubuntu-initial.sh . The setup shell script will create a new user inside the cloud server, installs/updates the necessary packages and libraries, installs firewalls, and sets up ssh. . Note: This new user creation is not to be confused with IAM user created by AWS root user. . Reboot when prompted. Wait a couple of minutes for reboot, then ssh back in. . To reconnect using ssh, add an additional -L flag which will allow you to open up ports to connect to Jupyter Notebook once it’s installed: . ssh -i &lt;path-to-pem-file&gt; -L localhost:8888:localhost:8888 ubuntu@&lt;ip-address&gt; . (Optional): Change default shell to ZSH with Oh My ZSH: . sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot; &quot;&quot; --unattended . Change default SHELL to ZSH using . sudo chsh $USER -s /bin/zsh . When prompted for password, use the password entered at the user creation step during the setup process. . Logout and login again to activate ZSH shell. It is possible to switch without disconnecting but I find this step simpler to other solutions. . Setup Conda . Conda is an open source package management system to setup environments irrespective of the OS. One of the major advantages of conda is that it easily installs all the dependencies for a package. Anaconda provides a conda installer with thousands of packages. However, for our case, we will use Miniconda, a minimal installer of conda. . cd fastsetup ./setup-conda.sh . Note: Deviates from fastai’s fastsetup setup-conda.shscript in creating a .condarc file. My experiments have shown this file to be troublesome. . If you’ve worked with conda installs before, you’ll know that it is too slow. Mamba is a reimplementation of the conda package manager in C++. So we install that next. . source ~/.bashrc (or source ~/.zshrc) conda install mamba -n base -c fastchan . We use fastchan as the channel source. fastchan is an anaconda pacakage from fastai team. A detailed post on fastchan from weights and biases. . Don’t mix conda-forge with fastai channels. Stick to either fastchan or anaconda. . Install Nvidia . It is much faster to train ML models in a GPU. Currently only Nvidia GPUs are supported. Since our instance has a GPU, we need to install its drivers and activate it. . Use this command to list available drivers: ubuntu-drivers devices . Tip: Choose the “recommended” option, plus the -server suffix. . When you install “470” might be a different number, based on ubuntu-drivers output above . sudo apt-fast install -y nvidia-driver-470-server sudo modprobe nvidia nvidia-smi . When prompted for a password, enter the password you entered while you ran the ubuntu setup script. . Note: The command installs cuda 11.4. This is not to be confused with cudatoolkit=11.1 which is needed for pytorch=1.9. Also each pytorch conda install comes with its own cuDNN runtime. So installing cuDNN separately is not needed. cuda 11.4 comes to play if pytorch is built from source. . Create conda environment . It is good practice to install the necessary packages in a new conda environment. Installing everything in the conda base environment is not advisable. . conda create -n &lt;envname&gt; -y conda create -n mlenv -y conda activate mlenv . Install fastbook with all its dependencies including CUDA enabled pytorch libraries . Now you’re ready to install all needed packages for the fast.ai course: Make there is enough space to install(df -h). You need about 15GB of space. . mamba install fastbook python=3.8 -c fastai -c fastchan -y conda install pytorch torchaudio torchvision python=3.8 cudatoolkit=11.1 -c fastchan -y . Fastbook is a fastai’s book on using fastai for ML development. As a python package, it installs all the dependent packages. To see what it install remove -y from the command. . Usually one command(mamba install fastbook) was enough previously to install everything. However, there seems to be package conflicts when executed now. Hence, the additional conda install step which upgrades pytorch, torchvision to the latest GPU version. . Tip: For dry run, use ‘-d’ argument in the mamba install command. . Note: Installing fastbook doesn’t mean you must use fastai. It just installs everything needed for ML tasks. If you’ve noticed carefully while installing, it is Pytorch, Cuda packages that require huge memory space. Other packages come just under 2 GB. . Sanity checks: . These checks are to verifying if indeed CUDA enabled pytorch is installed correctly. Enter these commands inside a python shell. . $which python /home/ubuntu/miniconda3/envs/mlenv/bin/python $python --version Python 3.8.5 $python &gt;&gt;&gt;import torch &gt;&gt;&gt;torch.version.cuda &#39;11.1&#39; &gt;&gt;&gt;torch.cuda.is_available() True &gt;&gt;&gt; torch.cuda.device_count() 1 &gt;&gt;&gt;torch.cuda.current_device() 0 &gt;&gt;&gt;torch.cuda.get_device_name(0) &#39;Tesla T4&#39; . If the commands return the same results, then we’re ready for ML development. . Run jupyter notebook . To download the notebooks, run: . cd git clone https://github.com/fastai/fastbook cd fastbook jupyter notebook . Click on the localhost url that is displayed. It will open iPython notebook in your default browser. Alternatively, that link can be copied and opened in any browser of choice. . There are other Jupyter notebook guides that require to add a password for access. So far I’ve not needed those steps for my tasks. . (Optional) Email Setup: . To set up email: . sudo ./opensmtpd-install.sh . To test email, create a text file msg containing a message to send, then send it with: . cat msg | mail -r &quot;x@$(hostname -d)&quot; -s &#39;subject&#39; EMAIL_ADDR . Replace EMAIL_ADDR with an address to send to. You can get a useful testing address from mail-tester. . Stopping the instance . After you have finished your work, unless a training is going on, it is critical to stop the instance, if you wish to save your AWS bill. . Use either EC2 dashboard to stop the instance(instance-&gt;actions-&gt;instance state-&gt;stop) or use this command in the terminal . sudo shutdown -h now . Note: Pressing terminate will remove the instance completely and your work will be lost forever. . Wrapping up . There it is: an instance that is ready for ML development. If you have questions or feedback, reach me through the comments or via twitter. .",
            "url": "https://dr563105.github.io/blog/aws/ubuntu/conda/fastai/pytorch/practical%20deep%20learning%20for%20coders/2021/09/17/aws-setup.html",
            "relUrl": "/aws/ubuntu/conda/fastai/pytorch/practical%20deep%20learning%20for%20coders/2021/09/17/aws-setup.html",
            "date": " • Sep 17, 2021"
        }
        
    
  
    
        ,"post1": {
            "title": "Fastpages Notebook Blog Post",
            "content": "About . This notebook is a demonstration of some of capabilities of fastpages with notebooks. . With fastpages you can save your jupyter notebooks into the _notebooks folder at the root of your repository, and they will be automatically be converted to Jekyll compliant blog posts! . Front Matter . The first cell in your Jupyter Notebook or markdown blog post contains front matter. Front matter is metadata that can turn on/off options in your Notebook. It is formatted like this: . # &quot;My Title&quot; &gt; &quot;Awesome summary&quot; - toc:true- branch: master - badges: true - comments: true - author: Hamel Husain &amp; Jeremy Howard - categories: [fastpages, jupyter] . Setting toc: true will automatically generate a table of contents | Setting badges: true will automatically include GitHub and Google Colab links to your notebook. | Setting comments: true will enable commenting on your blog post, powered by utterances. | . The title and description need to be enclosed in double quotes only if they include special characters such as a colon. More details and options for front matter can be viewed on the front matter section of the README. . Markdown Shortcuts . A #hide comment at the top of any code cell will hide both the input and output of that cell in your blog post. . A #hide_input comment at the top of any code cell will only hide the input of that cell. . The comment #hide_input was used to hide the code that produced this. . put a #collapse-hide flag at the top of any cell if you want to hide that cell by default, but give the reader the option to show it: . import pandas as pd import altair as alt . . put a #collapse-show flag at the top of any cell if you want to show that cell by default, but give the reader the option to hide it: . cars = &#39;https://vega.github.io/vega-datasets/data/cars.json&#39; movies = &#39;https://vega.github.io/vega-datasets/data/movies.json&#39; sp500 = &#39;https://vega.github.io/vega-datasets/data/sp500.csv&#39; stocks = &#39;https://vega.github.io/vega-datasets/data/stocks.csv&#39; flights = &#39;https://vega.github.io/vega-datasets/data/flights-5k.json&#39; . . place a #collapse-output flag at the top of any cell if you want to put the output under a collapsable element that is closed by default, but give the reader the option to open it: . print(&#39;The comment #collapse-output was used to collapse the output of this cell by default but you can expand it.&#39;) . The comment #collapse-output was used to collapse the output of this cell by default but you can expand it. . . Interactive Charts With Altair . Charts made with Altair remain interactive. Example charts taken from this repo, specifically this notebook. . Example 1: DropDown . # use specific hard-wired values as the initial selected values selection = alt.selection_single( name=&#39;Select&#39;, fields=[&#39;Major_Genre&#39;, &#39;MPAA_Rating&#39;], init={&#39;Major_Genre&#39;: &#39;Drama&#39;, &#39;MPAA_Rating&#39;: &#39;R&#39;}, bind={&#39;Major_Genre&#39;: alt.binding_select(options=genres), &#39;MPAA_Rating&#39;: alt.binding_radio(options=mpaa)} ) # scatter plot, modify opacity based on selection alt.Chart(df).mark_circle().add_selection( selection ).encode( x=&#39;Rotten_Tomatoes_Rating:Q&#39;, y=&#39;IMDB_Rating:Q&#39;, tooltip=&#39;Title:N&#39;, opacity=alt.condition(selection, alt.value(0.75), alt.value(0.05)) ) . Example 2: Tooltips . alt.Chart(df).mark_circle().add_selection( alt.selection_interval(bind=&#39;scales&#39;, encodings=[&#39;x&#39;]) ).encode( alt.X(&#39;Rotten_Tomatoes_Rating&#39;, type=&#39;quantitative&#39;), alt.Y(&#39;IMDB_Rating&#39;, type=&#39;quantitative&#39;, axis=alt.Axis(minExtent=30)), # y=alt.Y(&#39;IMDB_Rating:Q&#39;, ), # use min extent to stabilize axis title placement tooltip=[&#39;Title:N&#39;, &#39;Release_Date:N&#39;, &#39;IMDB_Rating:Q&#39;, &#39;Rotten_Tomatoes_Rating:Q&#39;] ).properties( width=500, height=400 ) . Example 3: More Tooltips . label = alt.selection_single( encodings=[&#39;x&#39;], # limit selection to x-axis value on=&#39;mouseover&#39;, # select on mouseover events nearest=True, # select data point nearest the cursor empty=&#39;none&#39; # empty selection includes no data points ) # define our base line chart of stock prices base = alt.Chart().mark_line().encode( alt.X(&#39;date:T&#39;), alt.Y(&#39;price:Q&#39;, scale=alt.Scale(type=&#39;log&#39;)), alt.Color(&#39;symbol:N&#39;) ) alt.layer( base, # base line chart # add a rule mark to serve as a guide line alt.Chart().mark_rule(color=&#39;#aaa&#39;).encode( x=&#39;date:T&#39; ).transform_filter(label), # add circle marks for selected time points, hide unselected points base.mark_circle().encode( opacity=alt.condition(label, alt.value(1), alt.value(0)) ).add_selection(label), # add white stroked text to provide a legible background for labels base.mark_text(align=&#39;left&#39;, dx=5, dy=-5, stroke=&#39;white&#39;, strokeWidth=2).encode( text=&#39;price:Q&#39; ).transform_filter(label), # add text labels for stock prices base.mark_text(align=&#39;left&#39;, dx=5, dy=-5).encode( text=&#39;price:Q&#39; ).transform_filter(label), data=stocks ).properties( width=500, height=400 ) . Data Tables . You can display tables per the usual way in your blog: . df[[&#39;Title&#39;, &#39;Worldwide_Gross&#39;, &#39;Production_Budget&#39;, &#39;Distributor&#39;, &#39;MPAA_Rating&#39;, &#39;IMDB_Rating&#39;, &#39;Rotten_Tomatoes_Rating&#39;]].head() . Title Worldwide_Gross Production_Budget Distributor MPAA_Rating IMDB_Rating Rotten_Tomatoes_Rating . 0 The Land Girls | 146083.0 | 8000000.0 | Gramercy | R | 6.1 | NaN | . 1 First Love, Last Rites | 10876.0 | 300000.0 | Strand | R | 6.9 | NaN | . 2 I Married a Strange Person | 203134.0 | 250000.0 | Lionsgate | None | 6.8 | NaN | . 3 Let&#39;s Talk About Sex | 373615.0 | 300000.0 | Fine Line | None | NaN | 13.0 | . 4 Slam | 1087521.0 | 1000000.0 | Trimark | R | 3.4 | 62.0 | . Images . Local Images . You can reference local images and they will be copied and rendered on your blog automatically. You can include these with the following markdown syntax: . ![](my_icons/fastai_logo.png) . . Remote Images . Remote images can be included with the following markdown syntax: . ![](https://image.flaticon.com/icons/svg/36/36686.svg) . . Animated Gifs . Animated Gifs work, too! . ![](https://upload.wikimedia.org/wikipedia/commons/7/71/ChessPawnSpecialMoves.gif) . . Captions . You can include captions with markdown images like this: . ![](https://www.fast.ai/images/fastai_paper/show_batch.png &quot;Credit: https://www.fast.ai/2020/02/13/fastai-A-Layered-API-for-Deep-Learning/&quot;) . . Other Elements . GitHub Flavored Emojis . Typing I give this post two :+1:! will render this: . I give this post two :+1:! . Tweetcards . Typing &gt; twitter: https://twitter.com/jakevdp/status/1204765621767901185?s=20 will render this: Altair 4.0 is released! https://t.co/PCyrIOTcvvTry it with: pip install -U altairThe full list of changes is at https://t.co/roXmzcsT58 ...read on for some highlights. pic.twitter.com/vWJ0ZveKbZ . &mdash; Jake VanderPlas (@jakevdp) December 11, 2019 . Youtube Videos . Typing &gt; youtube: https://youtu.be/XfoYk_Z5AkI will render this: . Boxes / Callouts . Typing &gt; Warning: There will be no second warning! will render this: . Warning: There will be no second warning! . Typing &gt; Important: Pay attention! It&#39;s important. will render this: . Important: Pay attention! It&#8217;s important. . Typing &gt; Tip: This is my tip. will render this: . Tip: This is my tip. . Typing &gt; Note: Take note of this. will render this: . Note: Take note of this. . Typing &gt; Note: A doc link to [an example website: fast.ai](https://www.fast.ai/) should also work fine. will render in the docs: . Note: A doc link to an example website: fast.ai should also work fine. . Footnotes . You can have footnotes in notebooks, however the syntax is different compared to markdown documents. This guide provides more detail about this syntax, which looks like this: . For example, here is a footnote {% fn 1 %}. And another {% fn 2 %} {{ &#39;This is the footnote.&#39; | fndetail: 1 }} {{ &#39;This is the other footnote. You can even have a [link](www.github.com)!&#39; | fndetail: 2 }} . For example, here is a footnote 1. . And another 2 . 1. This is the footnote.↩ . 2. This is the other footnote. You can even have a link!↩ .",
            "url": "https://dr563105.github.io/blog/jupyter/2020/02/20/test.html",
            "relUrl": "/jupyter/2020/02/20/test.html",
            "date": " • Feb 20, 2020"
        }
        
    
  

  
  

  
      ,"page1": {
          "title": "About Me",
          "content": "This website is powered by fastpages 1. . a blogging platform that natively supports Jupyter notebooks in addition to other formats. &#8617; . |",
          "url": "https://dr563105.github.io/blog/about/",
          "relUrl": "/about/",
          "date": ""
      }
      
  

  

  
  

  

  
  

  

  
  

  
  

  
      ,"page9": {
          "title": "",
          "content": "Sitemap: {{ “sitemap.xml” | absolute_url }} | .",
          "url": "https://dr563105.github.io/blog/robots.txt",
          "relUrl": "/robots.txt",
          "date": ""
      }
      
  

  
  

}